<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Alef:wght@400;700&display=block">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Alef:wght@400;700&display=block">
    <link rel="preload" href="Alef-Monospace.woff2" as="font" type="font/woff2" crossorigin>
    <script src="pages.js"></script>
    <link rel="stylesheet" href="style.css">
    <meta property="og:image" content="https://oulipoh.com/resen/media/og_image.jpg">
</head>
<body style="visibility: hidden" onload="document.body.style.visibility = 'visible'; iframe.src = 'https://player.vimeo.com/video/469788336?byline=0&loop=1&portrait=0&quality=1080p&title=0'">
    <noscript><style>body {visibility: visible !important}</style></noscript>
    <script>make_header()</script>
    <p>
        <a href="https://en.wikipedia.org/wiki/Cyclic_cellular_automaton">אוטומט תאי ציקלי</a> מבוסס אותיות.
        אות תתקדם לאות שבאה אחריה באלף־בית, אם לפחות אחת משמונת האותיות הסובבות היא האות החדשה הזו. בנוסף, מילים מסוימות, כשהן נוצרות באופן ספונטני, יכולות לקפוא ויותר לא להשתנות. הקליקי בשביל לאתחל.
    </p>
    <div class="sliders">
        <label>
            <span onclick="lang_slider.value = 0; reset_flag = true">English</span>
            <input type="range" id="lang_slider" max="1" value="1" autocomplete="off">
            <span onclick="lang_slider.value = 1; reset_flag = true">Hebrew</span>
        </label>
        <label>
            <span onclick="rate_slider.value = 0">Slow</span>
            <input type="range" id="rate_slider" value="50" autocomplete="off">
            <span onclick="rate_slider.value = 100">Fast</span>
        </label>
        <label>
            <span onclick="freeze_slider.value = 0">Unfreeze</span>
            <input type="range" id="freeze_slider" max="1" value="1" autocomplete="off" oninput="frozen = Array(w * h).fill(0)">
            <span onclick="freeze_slider.value = 1">Freeze</span>
        </label>
        <label>
            <span onclick="glitch_slider.value = 0">Normal</span>
            <input type="range" id="glitch_slider" max="1" value="0" autocomplete="off">
            <span onclick="glitch_slider.value = 1">Glitch</span>
        </label>
    </div>
    <pre id="grid" onclick="reset_flag = true" title="Click to restart"></pre>
    <p dir="ltr">
        Letter-based <a href="https://en.wikipedia.org/wiki/Cyclic_cellular_automaton">cyclic cellular automata</a>.
        A letter will advance to the letter that follows it in the alphabet, if at least one of the eight surrounding letters is that new letter. In addition, certain words, as they form spontaneously, can freeze and not change anymore. Click to restart.
    </p>
    <p>
        ב־"להט החרב המתהפכת" ניסיתי להשתמש בזה בשביל לחולל <a href="#magicspell" onclick="open_internal_link(event)">לחשקסם</a>:
    </p>
    <iframe id="iframe" allow="fullscreen; web-share" class="video"></iframe>
    <div class="refs">
        <blockquote>Saskia Hiltemann, <a href="https://theses.liacs.nl/pdf/16-SaskiaHiltemann.pdf">Multi-coloured Cellular Automata</a>.</blockquote>
        <blockquote>Laurel O'Brien, <a href="https://github.com/laurelobrien/typo-automata">typo-automata</a>.</blockquote>
    </div>
    <script>
        make_footer()

        const w = 160;
        const h = 80;
        const chars = ['abcdefghijklmnopqrstuvwxyz', 'אבגדהוזחטיכלמנסעפצקרשת'];
        const words = [['foo', 'bar'], ['לחש', 'קסם']];

        let lang, freeze, glitch;

        function next(x, k) {
            if (freeze && frozen[k])
                return x;
            let i = glitch ? k/w | h : k/w + h | 0;
            let j = k%w + w;
            let next_ind = (x+1) % chars[lang].length;
            let m, n;
            for (m = -1; m < 2; m++)
                for (n = -1; n < 2; n++)
                    if (ind_grid[(i+m)%h*w + (j+n)%w] == next_ind)
                        return next_ind;
            return x;
        }

        function update() {
                if (lang != lang_slider.value || reset_flag) {
                    lang = lang_slider.value;
                    reset_flag = false;
                    ind_grid = Array(w * h).fill().map(() => Math.random() * chars[lang].length | 0);
                frozen = Array(w * h).fill(0);
                regexp = words[lang].length ? new RegExp(words[lang].join('|'), 'g') : null;
                }
            let text = ind_grid.map((x, k) => (k % w || !k ? '' : '\n') + chars[lang][x]).join('');
            freeze = freeze_slider.value == '1';
            if (freeze && regexp) {
                if (lang == '1')
                    for (const word of words[lang])
                        text = text.replaceAll(word.replace(/ך/g, 'כ').replace(/ם/g, 'מ').replace(/ן/g, 'נ').replace(/ף/g, 'פ').replace(/ץ/g, 'צ'), word);
                let start;
                for (const match of text.matchAll(regexp))
                {
                    start = match.index - (match.index/(w+1)|0);
                    frozen.fill(1, start, start + match[0].length);
                }
                //for (const word of words[lang])
                //    text = text.replaceAll(word, '<span style="color: var(--fg_highlight)">$&</span>');
            }
            // grid.innerHTML = text;
            grid.textContent = text;
            glitch = glitch_slider.value == '1';
            ind_grid = ind_grid.map(next);
                setTimeout(update, 1000 - Math.log10(rate_slider.value*99.99 + 1)*250);
        }
        update();
    </script>
</body>
</html>